{"ast":null,"code":"import _classPrivateFieldInitSpec from \"C:/Users/Admin/Desktop/fluent_GJ/frontend/node_modules/@babel/runtime/helpers/esm/classPrivateFieldInitSpec.js\";\nimport _classPrivateFieldSet from \"C:/Users/Admin/Desktop/fluent_GJ/frontend/node_modules/@babel/runtime/helpers/esm/classPrivateFieldSet2.js\";\nimport _classPrivateFieldGet from \"C:/Users/Admin/Desktop/fluent_GJ/frontend/node_modules/@babel/runtime/helpers/esm/classPrivateFieldGet2.js\";\nimport { WebSocket as _WebSocket } from \"./ws.js\"; /*-browser*/\nimport { SocketProvider } from \"./provider-socket.js\";\n/**\n *  A JSON-RPC provider which is backed by a WebSocket.\n *\n *  WebSockets are often preferred because they retain a live connection\n *  to a server, which permits more instant access to events.\n *\n *  However, this incurs higher server infrasturture costs, so additional\n *  resources may be required to host your own WebSocket nodes and many\n *  third-party services charge additional fees for WebSocket endpoints.\n */\nvar _connect = /*#__PURE__*/new WeakMap();\nvar _websocket = /*#__PURE__*/new WeakMap();\nexport class WebSocketProvider extends SocketProvider {\n  get websocket() {\n    if (_classPrivateFieldGet(_websocket, this) == null) {\n      throw new Error(\"websocket closed\");\n    }\n    return _classPrivateFieldGet(_websocket, this);\n  }\n  constructor(url, network, options) {\n    super(network, options);\n    _classPrivateFieldInitSpec(this, _connect, void 0);\n    _classPrivateFieldInitSpec(this, _websocket, void 0);\n    if (typeof url === \"string\") {\n      _classPrivateFieldSet(_connect, this, () => {\n        return new _WebSocket(url);\n      });\n      _classPrivateFieldSet(_websocket, this, _classPrivateFieldGet(_connect, this).call(this));\n    } else if (typeof url === \"function\") {\n      _classPrivateFieldSet(_connect, this, url);\n      _classPrivateFieldSet(_websocket, this, url());\n    } else {\n      _classPrivateFieldSet(_connect, this, null);\n      _classPrivateFieldSet(_websocket, this, url);\n    }\n    this.websocket.onopen = async () => {\n      try {\n        await this._start();\n        this.resume();\n      } catch (error) {\n        console.log(\"failed to start WebsocketProvider\", error);\n        // @TODO: now what? Attempt reconnect?\n      }\n    };\n    this.websocket.onmessage = message => {\n      this._processMessage(message.data);\n    };\n    /*\n            this.websocket.onclose = (event) => {\n                // @TODO: What event.code should we reconnect on?\n                const reconnect = false;\n                if (reconnect) {\n                    this.pause(true);\n                    if (this.#connect) {\n                        this.#websocket = this.#connect();\n                        this.#websocket.onopen = ...\n                        // @TODO: this requires the super class to rebroadcast; move it there\n                    }\n                    this._reconnect();\n                }\n            };\n    */\n  }\n  async _write(message) {\n    this.websocket.send(message);\n  }\n  async destroy() {\n    if (_classPrivateFieldGet(_websocket, this) != null) {\n      _classPrivateFieldGet(_websocket, this).close();\n      _classPrivateFieldSet(_websocket, this, null);\n    }\n    super.destroy();\n  }\n}\n//# sourceMappingURL=provider-websocket.js.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}